<!DOCTYPE html>
<html style="height: 100%">
   <head>
       <meta charset="utf-8">
       <title>Line Chart</title>
   </head>
   <body style="height: 100%; margin: 0">
       <div id="container" style="height: 100%"></div>
       <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts-all-3.js"></script>
       <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
       <script type="text/javascript">
           var dom = document.getElementById("container");
           var myChart = echarts.init(dom);
           var app = {};
           //Function(json file and search name as parameters) for finding the counts for a name
           var findCount = function(data, name) {
               var targetData = data.filter(function (n) {
                    //Name obtained from search box
                    return n.name === name;
                });
                //Arrays to store information for different regions
                var engData = targetData.filter(function (n) {
                    return n.country ==='England';
                });
                var scoData = targetData.filter(function (n) {
                    return n.country ==='Scotland';
                });
                var walData = targetData.filter(function (n) {
                    return n.country ==='Wales';
                });
                var ireData = targetData.filter(function (n) {
                    return n.country ==='Northern Ireland';
                });
                //Arrays to store numbers of a name for different regions and years
                var engCount = [0, 0, 0, 0, 0, 0],
                    scoCount = [0, 0, 0, 0, 0, 0],
                    walCount = [0, 0, 0, 0, 0, 0],
                    ireCount = [0, 0, 0, 0, 0, 0];
                var allData = [engData, scoData, walData, ireData],
                    allCount = [engCount, scoCount, walCount, ireCount];
                for(var i=0; i<4; i++) {
                    for(var j=0; j<allData[i].length; j++){
                        //Skip the years where the number is absent, leave them 0
                        allCount[i][allData[i][j].year - 2010] = allData[i][j].count;
                    }
                }
               return allCount;
           };
           //Function(json file and search name as parameters) for finding the ranks for a name
           var findRank = function(data, name) {
               var targetData = data.filter(function (n) {
                    //Name obtained from search box
                    return n.name === name;
                });
                //Arrays to store information for different regions
                var engData = targetData.filter(function (n) {
                    return n.country ==='England';
                });
                var scoData = targetData.filter(function (n) {
                    return n.country ==='Scotland';
                });
                var walData = targetData.filter(function (n) {
                    return n.country ==='Wales';
                });
                var ireData = targetData.filter(function (n) {
                    return n.country ==='Northern Ireland';
                });
                //Arrays to store ranks for different regions
                var engRank = [null, null, null, null, null, null], 
                    scoRank = [null, null, null, null, null, null], 
                    walRank = [null, null, null, null, null, null], 
                    ireRank = [null, null, null, null, null, null];
                var allData = [engData, scoData, walData, ireData],
                    allRank = [engRank, scoRank, walRank, ireRank];
                for(var i=0; i<4; i++) {
                    for(var j=0; j<allData[i].length; j++){
                        //Skip the years where the rank is absent, leave them null
                        allRank[i][allData[i][j].year - 2010] = allData[i][j].rank;
                    }
                }
               return allRank;
           };
           
           //Find the counts for a name in different regions in a specific year
           var findCounts = function (data, name, year) {
                    var nameData = data.filter(function(d) {
                    return d.name === name.toLowerCase() && d.year === parseInt(year);
                    });
                    
                    //Count array respectively for England, Wales, Scotland, Northern Ireland
                    var nameCount = [null, null, null, null];
                    for(var i = 0; i < nameData.length; i++) {
                        switch(nameData[i].country) {
                            case 'England':
                                nameCount[0] = nameData[i].count;
                                break;
                            case 'Wales':
                                nameCount[1] = nameData[i].count;
                                break;
                            case 'Scotland':
                                nameCount[2] = nameData[i].count;
                                break;
                            case 'Northern Ireland':
                                nameCount[3] = nameData[i].count;
                        }
                    }
                    return nameCount;
            };
           
           //Find the top k names of some gender in some region in some year
           //if region is not All Region
           var filterNames = function(data, start, end, gender, year, region) {
               var gender1 = gender === 'Boy Only'? 'M':'F';
               var filterData = data.filter(function(d) {
                   return d.rank >= parseInt(start) && d.rank <= parseInt(end) && d.gender === gender1 && d.year === parseInt(year) && d.country === region;
               });
               console.log(filterData);
               //Name for y axis and count for x axis
               var barData = {name: [], count: []};
               for(var i = 0; i < filterData.length; i++) {
                   barData.name.push(filterData[i].name);
                   barData.count.push(filterData[i].count);
               }
               console.log(barData);
               return barData;
           };
           
           $.get('dataset.json').done(function (data) {
                //ranks for JACK
                var ranks = findRank(data, 'JACK');
                //Arrays to store ranks for different regions
                var engRank = ranks[0], 
                    scoRank = ranks[1], 
                    walRank = ranks[2], 
                    ireRank = ranks[3];
               
               //counts for JACK
               var counts = findCount(data, 'JACK');
               
               //name and year: strings
               var nameCount = findCounts(data, 'George', '2012');
               
               var barData = filterNames(data, '11', '20', 'Boy Only', '2015', 'England');
               
                //set option for the line chart
                myChart.setOption({
                title: {
                    text: 'The rank change from 2010 to 2015',
                    subtext: 'Jack'
                },
                tooltip: {
                    trigger: 'axis'
                },
                legend: {
                    data:['England','Scotland','Wales','Northern Ireland']
                },
                calculable: true,
                xAxis:  {
                    type: 'category',
                    boundaryGap: false,
                    data: ['2010','2011','2012','2013','2014','2015'],
                    name: 'Year',
                    axisLine: {onZero: false}
                },
                yAxis: {
                    type: 'value',
                    name: 'Rank',
                    nameLocation: 'middle',
                    nameGap: 25,
                    inverse: true
                },
                series: [{
                    name:'England',
                    type:'line',
                    data:engRank,
                    markPoint: {
                        data: [
                            {type: 'max', name: 'Lowest rank'},
                            {type: 'min', name: 'Highest rank'}
                        ]
                    },
                    markLine: {
                        data: [
                            {type: 'average', name: 'Average rank'}
                        ]
                    }
                    },
                    {
                    name:'Scotland',
                    type:'line',
                    data:scoRank,
                    markPoint: {
                        data: [
                            {type: 'max', name: 'Lowest rank'},
                            {type: 'min', name: 'Highest rank'}
                        ]
                    },
                    markLine: {
                        data: [
                            {type: 'average', name: 'Average rank'}
                        ]
                    }
                    },
                    {
                    name:'Wales',
                    type:'line',
                    data:walRank,
                    markPoint: {
                        data: [
                            {type: 'max', name: 'Lowest rank'},
                            {type: 'min', name: 'Highest rank'}
                        ]
                    },
                    markLine: {
                        data: [
                            {type: 'average', name: 'Average rank'}
                        ]
                    }
                    },
                    {
                    name:'Northern Ireland',
                    type:'line',
                    data:ireRank,
                    markPoint: {
                        data: [
                            {type: 'max', name: 'Lowest rank'},
                            {type: 'min', name: 'Highest rank'}
                        ]
                    },
                    markLine: {
                        data: [
                            {type: 'average', name: 'Average rank'}
                        ]
                    }
                    }
                ]
            });
        });
            
            /*if (option && typeof option === "object") {
                myChart.setOption(option, true);
            }*/
       </script>
   </body>
</html>